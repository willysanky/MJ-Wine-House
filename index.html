// === FILE: package.json ===
{
  "name": "mj-wines-fullstack",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "cors": "^2.8.5",
    "dotenv": "^16.0.3",
    "express": "^4.18.2",
    "mongoose": "^7.0.4"
  }
}

// === FILE: .env ===
PORT=5000
MONGO_URI=mongodb+srv://<yourUser>:<yourPass>@cluster0.mongodb.net/mjwines?retryWrites=true&w=majority

// === FILE: models/Order.js ===
const mongoose = require('mongoose');

const orderSchema = new mongoose.Schema({
  name: String,
  phone: String,
  address: String,
  paymethod: String,
  total: Number,
  items: [
    {
      name: String,
      price: Number
    }
  ],
  createdAt: { type: Date, default: Date.now }
});

module.exports = mongoose.model('Order', orderSchema);

// === FILE: server.js ===
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const path = require('path');
require('dotenv').config();

const Order = require('./models/Order');

const app = express();
app.use(cors());
app.use(express.json());
app.use(express.static(path.join(__dirname, 'client')));

mongoose.connect(process.env.MONGO_URI)
  .then(() => console.log('MongoDB connected'))
  .catch(err => console.error('MongoDB connection error:', err));

// POST /api/orders
app.post('/api/orders', async (req, res) => {
  try {
    const order = new Order(req.body);
    await order.save();
    res.status(201).json({ message: 'Order saved!' });
  } catch (err) {
    res.status(500).json({ error: 'Failed to save order' });
  }
});

// GET /api/orders
app.get('/api/orders', async (req, res) => {
  const orders = await Order.find().sort({ createdAt: -1 });
  res.json(orders);
});

// Serve index.html and admin.html for frontend
app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, 'client/index.html'));
});

app.get('/admin', (req, res) => {
  res.sendFile(path.join(__dirname, 'client/admin.html'));
});

const PORT = process.env.PORT || 5000;
app.listen(PORT, () => console.log(`Server running on port ${PORT}`));

// === FILE: client/index.html ===
<!-- You already have the improved index.html file for MJ Wines -->
<!-- Paste your full index.html code here (from previous response) -->

// === FILE: client/admin.html ===
<!DOCTYPE html>
<html>
<head>
  <title>Admin Orders</title>
  <style>
    body { font-family: Arial; margin: 2em; background: #f8f8f8; }
    h1 { color: #8b0000; }
    .order { background: white; padding: 1em; margin-bottom: 1em; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>Orders Received</h1>
  <div id="orders"></div>

  <script>
    fetch('/api/orders')
      .then(res => res.json())
      .then(data => {
        const ordersDiv = document.getElementById('orders');
        data.forEach(order => {
          const div = document.createElement('div');
          div.className = 'order';
          div.innerHTML = `
            <strong>${order.name}</strong> - ${order.phone}<br>
            <em>${order.address}</em><br>
            <b>Total:</b> KES ${order.total}<br>
            <b>Items:</b> ${order.items.map(i => i.name).join(', ')}<br>
            <small>${new Date(order.createdAt).toLocaleString()}</small>
          `;
          ordersDiv.appendChild(div);
        });
      });
  </script>
</body>
</html>
